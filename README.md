# FiveStar Support SDK for C# / .NET

[![C#](https://img.shields.io/badge/C%23-11+-blue.svg)](https://docs.microsoft.com/en-us/dotnet/csharp/)
[![.NET](https://img.shields.io/badge/.NET-8.0-purple.svg)](https://dotnet.microsoft.com/download/dotnet/8.0)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

C# / .NET SDK for integrating FiveStar Support feedback collection into your applications.

## Features

- **Server-Side Customer ID Generation**: Secure customer IDs generated by the server
- **Response Types**: Fetch available feedback categories (bug, feature request, etc.)
- **Feedback Submission**: Submit bug reports and feature requests
- **Type-Safe Models**: Record types with full type hints
- **async/await Throughout**: Built-in async support for .NET

## Requirements

- .NET 8.0 or higher

## Installation

```bash
dotnet add package FiveStarSupport
```

Or add to your `.csproj`:

```xml
<PackageReference Include="FiveStarSupport" Version="1.1.0" />
```

## Quick Start

```csharp
using FiveStarSupport;
using FiveStarSupport.Models;

// Initialize the client
var client = new FiveStarClient(
    clientId: "your-client-id",
    platform: "web",              // 'web', 'ios', 'android', 'flutter', 'laravel'
    appVersion: "1.0.0"
);

// Generate a customer ID from the server
var result = await client.GenerateCustomerIdAsync();
var customerId = result.CustomerId;

// Register the customer
var customerResult = await client.RegisterCustomerAsync(
    customerId: customerId,
    options: new RegisterCustomerOptions(
        Email: "user@example.com",
        Name: "John Doe"
    )
);

// Get available response types
var types = await client.GetResponseTypesAsync();

// Submit feedback
var response = await client.SubmitResponseAsync(
    new SubmitResponseOptions(
        CustomerId: customerId,
        Title: "App crashes on launch",
        Description: "The app crashes immediately after opening",
        TypeId: types[0].Id
    )
);

Console.WriteLine($"Response submitted: {response.ResponseId}");

// Dispose when done
await client.DisposeAsync();
```

Or use `await using`:

```csharp
await using var client = new FiveStarClient(clientId: "your-client-id");
var types = await client.GetResponseTypesAsync();
Console.WriteLine($"Available types: {string.Join(", ", types.Select(t => t.Name))}");
```

## Usage

### Initialization

```csharp
var client = new FiveStarClient(
    clientId: "your-client-id",
    apiUrl: "https://fivestar.support",  // optional
    timeout: TimeSpan.FromSeconds(30),   // optional
    platform: "web",                     // optional: 'web', 'ios', 'android', etc.
    appVersion: "1.0.0",                 // optional
    deviceModel: "iPhone14,2",           // optional
    osVersion: "16.0"                    // optional
);
```

### Generate Customer ID

Customer IDs are now generated server-side with cryptographic signing:

```csharp
var result = await client.GenerateCustomerIdAsync();

Console.WriteLine($"Customer ID: {result.CustomerId}");
Console.WriteLine($"Expires At: {result.ExpiresAt}");
Console.WriteLine($"Device ID: {result.DeviceId}");
```

### Register Customer

```csharp
await client.RegisterCustomerAsync(
    customerId: customerId,
    options: new RegisterCustomerOptions(
        Email: "user@example.com",
        Name: "John Doe"
    )
);
```

### Get Response Types

```csharp
var types = await client.GetResponseTypesAsync();
// Returns: ResponseType[] with Id, Name, Slug, Color, Icon
```

### Submit Feedback

```csharp
var response = await client.SubmitResponseAsync(
    new SubmitResponseOptions(
        CustomerId: customerId,
        Title: "Feature Request: Dark mode",
        Description: "Please add dark mode support",
        TypeId: types[0].Id
    )
);
```

### Verify Customer ID

```csharp
var result = await client.VerifyCustomerAsync(customerId);

if (result.Valid)
{
    Console.WriteLine("Customer ID is valid and registered");
}
else
{
    Console.WriteLine($"Verification failed: {result.Message}");
}
```

### Public URL Generation

```csharp
// Default (no locale)
var url = client.GetPublicUrl();
// => "https://fivestar.support/c/your-client-id"

// With locale
var localizedUrl = client.GetPublicUrl("fr");
// => "https://fivestar.support/fr/c/your-client-id"
```

## API Reference

### FiveStarClient

Main client for interacting with the FiveStar Support API.

#### Initialization

```csharp
var client = new FiveStarClient(
    clientId: "your-client-id",
    apiUrl: "https://fivestar.support",  // optional
    timeout: TimeSpan.FromSeconds(30),   // optional
    platform: "web",                      // optional
    appVersion: "1.0.0",                  // optional
    deviceModel: "iPhone14,2",            // optional
    osVersion: "16.0"                     // optional
);
```

| Parameter     | Type        | Default                      | Description         |
| ------------- | ----------- | ---------------------------- | ------------------- |
| `clientId`    | `string`    | _required_                   | Your client UUID    |
| `apiUrl`      | `string?`   | `"https://fivestar.support"` | API base URL        |
| `timeout`     | `TimeSpan?` | `30 seconds`                 | Request timeout     |
| `platform`    | `string?`   | `null`                       | Platform identifier |
| `appVersion`  | `string?`   | `null`                       | App version string  |
| `deviceModel` | `string?`   | `null`                       | Device model        |
| `osVersion`   | `string?`   | `null`                       | OS version          |

#### Methods

| Method                                       | Description                            |
| -------------------------------------------- | -------------------------------------- |
| `GetResponseTypesAsync()`                    | Get all available response types       |
| `GenerateCustomerIdAsync()`                  | Generate a new customer ID from server |
| `RegisterCustomerAsync(customerId, options)` | Register a customer ID                 |
| `VerifyCustomerAsync(customerId)`            | Verify a customer ID                   |
| `SubmitResponseAsync(options)`               | Submit a new response/feedback         |
| `GetPublicUrl(locale)`                       | Get public feedback page URL           |

### Data Models

#### GenerateCustomerIdResult

```csharp
public record GenerateCustomerIdResult(
    string CustomerId,    // The server-generated customer ID
    string ExpiresAt,     // ISO datetime when ID expires
    string DeviceId       // Short device identifier
);
```

#### RegisterCustomerOptions

```csharp
public record RegisterCustomerOptions(
    string? Email = null,  // Optional: Customer email
    string? Name = null    // Optional: Customer name
);
```

#### SubmitResponseOptions

```csharp
public record SubmitResponseOptions(
    string CustomerId,     // Required: Customer ID
    string Title,          // Required: Feedback title
    string Description,    // Required: Feedback description
    string TypeId,         // Required: Response type ID
    string? Email = null,  // Optional: Customer email
    string? Name = null    // Optional: Customer name
);
```

#### VerifyCustomerResult

```csharp
public record VerifyCustomerResult(
    bool Valid,            // Whether the customer ID is valid
    string? Message = null // Optional message
);
```

#### ResponseType

```csharp
public record ResponseType(
    string Id,
    string Name,
    string Slug,
    string Color,
    string Icon
);
```

## Error Handling

All async methods can throw `FiveStarAPIError`:

```csharp
try
{
    var types = await client.GetResponseTypesAsync();
}
catch (FiveStarAPIError e)
{
    Console.WriteLine($"API Error: {e.Message}");
    if (e.StatusCode != null)
    {
        Console.WriteLine($"Status Code: {e.StatusCode}");
    }
}
```

### Customer ID Generation

```csharp
var result = await client.GenerateCustomerIdAsync();
var customerId = result.CustomerId;
```

### Registration

```csharp
await client.RegisterCustomerAsync(
    customerId: customerId,
    options: new RegisterCustomerOptions(
        Email: "user@example.com",
        Name: "John Doe"
    )
);
```

## License

MIT License - see LICENSE file for details.

## Support

- Documentation: https://fivestar.support
- GitHub Issues: https://github.com/ryanw3b3r/fivestar-sdk-csharp/issues
